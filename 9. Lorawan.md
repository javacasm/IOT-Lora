## LoraWAN

LoRaWAN (Long Range Wide Area Network) es un protocolo de red de área amplia de bajo consumo (LPWAN, por sus siglas en inglés) diseñado específicamente para conectar dispositivos de Internet de las Cosas (IoT) a largas distancias con un consumo energético mínimo. Es una capa de comunicación que se basa en la tecnología de modulación LoRa, desarrollada por Semtech, y está optimizada para aplicaciones que requieren enviar pequeñas cantidades de datos de manera intermitente, como sensores de temperatura, medidores inteligentes o rastreadores GPS.

A continuación, te doy una explicación detallada de qué es LoRaWAN, cómo funciona, sus características, arquitectura, ventajas, limitaciones y ejemplos de uso.

---

¿Qué es LoRaWAN?

LoRaWAN es un estándar abierto gestionado por la LoRa Alliance, una organización sin fines de lucro que promueve la interoperabilidad y adopción de esta tecnología. No es lo mismo que LoRa, que es la capa física (modulación de radio), mientras que LoRaWAN define la capa de red y el protocolo que organiza la comunicación entre dispositivos, gateways y servidores.

- LoRa: Tecnología de modulación de espectro ensanchado que permite comunicaciones de largo alcance (hasta 15 km en condiciones ideales) con bajo consumo.
    
- LoRaWAN: Protocolo que especifica cómo los dispositivos usan LoRa para enviar datos a través de una red, incluyendo seguridad, autenticación y gestión.
    

LoRaWAN opera en bandas de frecuencia ISM (Industrial, Scientific, Medical) sin licencia, como 868 MHz en Europa, 915 MHz en América del Norte y 433 MHz en algunas regiones, lo que evita costos asociados a espectros licenciados como los de las redes celulares.

---

¿Cómo funciona LoRaWAN?

LoRaWAN organiza la comunicación en una topología de red en estrella, donde los dispositivos (nodos) se conectan a uno o más gateways, que a su vez se comunican con servidores de red a través de Internet. Aquí están los componentes clave y el flujo de datos:

1. Componentes de la arquitectura

- Nodos (End Devices):
    
    - Dispositivos finales como sensores o actuadores (por ejemplo, una ESP32 con un módulo RFM95).
    - Envían datos (uplink) o reciben comandos (downlink) usando LoRa.
    - Clasificados en tres tipos según su comportamiento:
        - Clase A: Bajo consumo, solo escucha después de enviar (dos ventanas cortas de recepción).
        - Clase B: Escucha programada adicional para aplicaciones con más downlinks.
        - Clase C: Escucha continua, mayor consumo pero respuesta inmediata.
            
- Gateways
    - Actúan como puentes entre los nodos y los servidores.
    - Reciben señales LoRa y las envían al servidor de red por IP (WiFi, Ethernet, etc.).
    - No procesan los datos, solo los retransmiten.
        
- Network Server
    - Gestiona la red LoRaWAN: autenticación, encriptación, eliminación de duplicados (si varios gateways reciben el mismo mensaje) y enrutamiento de datos.
    - Decide qué gateway usa para enviar downlinks.
        
- Application Server:
    
    - Procesa los datos enviados por los nodos y los entrega a las aplicaciones del usuario.
    - Puede enviar comandos de vuelta a los nodos.
        
- Join Server (opcional):
    
    - Maneja la autenticación inicial en modo OTAA (Over-the-Air Activation).
        

1. Flujo de comunicación
2. Un nodo envía un mensaje LoRa (por ejemplo, "Humedad: 60%").
3. Uno o más gateways cercanos captan la señal y la retransmiten al Network Server por Internet.
4. El Network Server verifica la autenticidad (usando claves), elimina duplicados y desencripta el mensaje.
5. El mensaje se pasa al Application Server, que lo entrega a la aplicación del usuario (por ejemplo, una base de datos o dashboard).
6. Si hay un comando (downlink), el Network Server lo envía al mejor gateway para que llegue al nodo en su próxima ventana de recepción.
    
---

Características principales

1. Largo alcance:
    - Hasta 15 km en zonas rurales, 1-2 km en entornos urbanos (depende de obstáculos y frecuencia).
2. Bajo consumo:
    - Diseñado para dispositivos con batería, puede durar años con una sola carga (especialmente en Clase A).
3. Bajo ancho de banda:
    - Velocidades de 0.3 a 50 kbps, ideal para payloads pequeños (máximo 243 bytes por mensaje).
4. Seguridad:
    - Encriptación AES-128 en dos capas:
        - Network Session Key (NwkSKey): Entre nodo y Network Server.    
        - App Session Key (AppSKey): Entre nodo y Application Server.
5. Modos de activación:
    - OTAA: Claves dinámicas negociadas al unirse a la red (más seguro).
    - ABP: Claves preconfiguradas (más simple, pero menos flexible).
6. Escalabilidad:
    - Soporta miles de dispositivos por gateway, gracias a la modulación LoRa.

---

Ventajas de LoRaWAN

- Costo bajo: Usa bandas sin licencia y hardware asequible ( Ejemplo: RFM95 cuesta ~$5).
- Flexibilidad: Red pública (como TTN) o privada (con ChirpStack).
- Eficiencia energética: Ideal para sensores remotos sin acceso a energía constante.
- Interoperabilidad: Estandarizado por la LoRa Alliance, compatible con múltiples fabricantes.
- Cobertura extensa: Perfecto para áreas rurales o donde las redes celulares no llegan.

---

Limitaciones

- Bajo ancho de banda: No apto para video, audio o datos grandes.
- Duty cycle: Regulaciones en bandas ISM (por ejemplo, 1% en Europa) limitan la frecuencia de transmisión.
- Dependencia de gateways: Sin gateways cercanos, no hay comunicación a menos que instales uno.
- Latencia: No es ideal para aplicaciones en tiempo real (las ventanas de recepción tienen retrasos).
- Interferencias: Bandas ISM compartidas pueden sufrir ruido en áreas densas.

---

Ejemplos de uso

1. Agricultura inteligente:
    - Sensores de humedad en campos remotos envían datos cada hora a un gateway LoRaWAN.
2. Ciudades inteligentes:
    - Contenedores de basura con sensores que reportan su nivel de llenado.
3. Seguimiento de activos:
    - Rastreadores GPS en vehículos o animales con batería de larga duración.
4. Gestión de energía:
    - Medidores inteligentes que envían lecturas diarias a una utility.

---

Comparación con otras tecnologías

|Característica|LoRaWAN|NB-IoT|Sigfox|LTE-M|
|---|---|---|---|---|
|Alcance|2-15 km|1-10 km|3-50 km|1-10 km|
|Velocidad|0.3-50 kbps|20-250 kbps|100 bps|1 Mbps|
|Consumo|Muy bajo|Bajo|Muy bajo|Medio|
|Costo|Bajo|Medio-Alto|Medio|Alto|
|Infraestructura|Gateways|Celular|Operadores|Celular|
|Licencia|No|Sí|Sí|Sí|

---

Cómo empezar con LoRaWAN

1. Hardware:
    - Nodo: ESP32 + RFM95 o una placa integrada como TTGO LoRa.
    - Gateway: Compra uno ( Ejemplo: Dragino) o usa uno comunitario (TTN).
2. Red:
    - Únete a una red pública como TTN o configura una privada con ChirpStack.
3. Configuración:
    - Registra tu dispositivo con OTAA o ABP.
    - Usa claves (DevEUI, AppEUI, AppKey) para autenticación.
4. Programación:
    - Implementa un firmware (MicroPython, Arduino) para enviar datos LoRaWAN.

---

Relación con TTN

TTN es una implementación específica de LoRaWAN, una red comunitaria que usa este protocolo para conectar nodos a gateways y servidores. Sin embargo, LoRaWAN puede usarse con otras plataformas (Helium, LORIOT, etc.) o redes privadas, lo que lo hace más amplio que TTN.

---

Conclusión

LoRaWAN es una solución eficiente y versátil para IoT de largo alcance y bajo consumo, ideal para aplicaciones donde la prioridad es la duración de la batería y la cobertura sobre la velocidad. Su diseño abierto y su adopción por redes como TTN lo hacen accesible para todos, desde aficionados hasta empresas. Si necesitas más detalles (por ejemplo, sobre configuraciones específicas o ejemplos de código), ¡avísame!

## Probar TTN

Para probar si hay cobertura de The Things Network (TTN) utilizando una placa ESP32 con un módulo LoRa (como el RFM95 o uno integrado como en la TTGO LoRa), necesitas configurar un nodo LoRaWAN que intente enviar mensajes a TTN y verificar si estos llegan a la consola de TTN. A continuación, te explico paso a paso cómo hacerlo, incluyendo un enfoque práctico para confirmar la cobertura.

---

Requisitos

1. Hardware:
    - Placa ESP32 (genérica o TTGO LoRa).
    - Módulo LoRa RFM95 (si no está integrado en la placa).
    - Antena adecuada para la frecuencia de tu región (868 MHz en Europa, 915 MHz en América, etc.).
    - Cables (si el módulo LoRa no está integrado).
2. Software:
    - MicroPython instalado en el ESP32.
    - Un IDE como Thonny o uPyCraft.
    - Cuenta en TTN (console.thethingsnetwork.org).
3. Información previa:
    - Necesitarás un gateway LoRaWAN cercano registrado en TTN. Puedes verificar gateways activos en tu área en [TTN Mapper](https://ttnmapper.org/heatmap/) o en la consola de TTN bajo "Gateways".

---

Paso 1: Configurar TTN

1. Crea una aplicación en TTN:
    - Inicia sesión en [console.thethingsnetwork.org](console.thethingsnetwork.org).
    - Ve a "Applications" > "Add Application".
    - Completa:
        - Application ID: Ejemplo: ttn-micropython-test-cep-cordoba.
        - Description: "Prueba de cobertura".
        - Handler: Selecciona tu región ( Ejemplo: eu1 para Europa).
    - Haz clic en "Add Application".
        
2. Registra un dispositivo:
    
    - En tu aplicación, ve a "Devices" > "Register Device".
    - Selecciona ABP como método de activación (más sencillo para pruebas rápidas).
	- Completa:
        - Device ID: Ejemplo: esp32-lora-test.
        - Device EUI: Genera uno automáticamente o usa un valor único.

    - Desactiva "Frame Counter Checks" en "Settings" (para evitar problemas con el contador).
    - Guarda y copia:
        - Device Address (DevAddr).
        - Network Session Key (NwkSKey).
        - App Session Key (AppSKey).

---

Paso 2: Conectar el hardware

Si usas una placa genérica ESP32 con un módulo RFM95 separado, conecta los pines como sigue:

|Pin RFM95|Pin ESP32 (ejemplo)|Descripción|
|---|---|---|
|VCC|3.3V|Alimentación|
|GND|GND|Tierra|
|MOSI|GPIO 27|SPI MOSI|
|MISO|GPIO 19|SPI MISO|
|SCK|GPIO 5|SPI Clock|
|NSS (CS)|GPIO 18|Chip Select|
|DIO0|GPIO 26|Interrupción|
|RST|GPIO 14|Reset|

Nota: Si usas una TTGO LoRa (con RFM95 integrado), los pines ya están definidos (verifica el modelo exacto, como V1.6 usa RST en GPIO 23).

- Conecta una antena al módulo LoRa antes de encenderlo para evitar daños.
    

---

Paso 3: Código para probar cobertura

Usaremos los archivos sx127x.py, lora.py y main.py adaptados para enviar mensajes simples a TTN. Aquí te doy versiones básicas para una ESP32 genérica con RFM95. Si usas TTGO LoRa, ajusta los pines según el modelo (como en mi respuesta anterior).

sx127x.py

python

```python
from machine import Pin, SPI
import time

class SX127x:
    REG_FIFO = 0x00
    REG_OP_MODE = 0x01
    REG_FRF_MSB = 0x06
    REG_FRF_MID = 0x07
    REG_FRF_LSB = 0x08
    REG_PA_CONFIG = 0x09
    REG_FIFO_ADDR_PTR = 0x0D
    REG_FIFO_TX_BASE_ADDR = 0x0E
    REG_IRQ_FLAGS = 0x12
    REG_PAYLOAD_LENGTH = 0x22
    REG_VERSION = 0x42

    MODE_LONG_RANGE_MODE = 0x80
    MODE_SLEEP = 0x00
    MODE_STDBY = 0x01
    MODE_TX = 0x03

    def __init__(self, spi, cs, reset, dio0, freq=868.0):
        self.spi = spi
        self.cs = cs
        self.reset = reset
        self.dio0 = dio0
        self.freq = freq

        self.cs.value(1)
        self.reset.value(1)
        self.reset.value(0)
        time.sleep(0.01)
        self.reset.value(1)
        time.sleep(0.01)

        if self.read_register(self.REG_VERSION) != 0x12:
            raise Exception("SX127x no detectado")

        self.write_register(self.REG_OP_MODE, self.MODE_LONG_RANGE_MODE | self.MODE_SLEEP)
        frf = int((freq * 1000000.0) / 61.03515625)
        self.write_register(self.REG_FRF_MSB, (frf >> 16) & 0xFF)
        self.write_register(self.REG_FRF_MID, (frf >> 8) & 0xFF)
        self.write_register(self.REG_FRF_LSB, frf & 0xFF)
        self.write_register(self.REG_PA_CONFIG, 0x8F)  # Máxima potencia
        self.write_register(self.REG_FIFO_TX_BASE_ADDR, 0x00)
        self.write_register(self.REG_OP_MODE, self.MODE_LONG_RANGE_MODE | self.MODE_STDBY)

    def write_register(self, reg, value):
        self.cs.value(0)
        self.spi.write(bytes([reg | 0x80]))
        self.spi.write(bytes([value]))
        self.cs.value(1)

    def read_register(self, reg):
        self.cs.value(0)
        self.spi.write(bytes([reg & 0x7F]))
        value = self.spi.read(1)[0]
        self.cs.value(1)
        return value

    def send(self, data):
        self.write_register(self.REG_OP_MODE, self.MODE_LONG_RANGE_MODE | self.MODE_STDBY)
        self.write_register(self.REG_FIFO_ADDR_PTR, 0x00)
        self.write_register(self.REG_PAYLOAD_LENGTH, len(data))
        self.cs.value(0)
        self.spi.write(bytes([self.REG_FIFO | 0x80]))
        self.spi.write(data)
        self.cs.value(1)
        self.write_register(self.REG_OP_MODE, self.MODE_LONG_RANGE_MODE | self.MODE_TX)
        while self.read_register(self.REG_IRQ_FLAGS) & 0x08 == 0:
            time.sleep(0.001)
        self.write_register(self.REG_IRQ_FLAGS, 0x08)
        self.write_register(self.REG_OP_MODE, self.MODE_LONG_RANGE_MODE | self.MODE_STDBY)
```

lora.py

python

```python
from sx127x import SX127x
import ubinascii

class LoRa:
    LORAWAN = 1
    EU868 = 1

    def __init__(self, sx127x):
        self.sx127x = sx127x
        self.dev_addr = None
        self.nwk_skey = None
        self.app_skey = None

    def init(self, mode, region, device_address, network_key, app_key):
        if mode != self.LORAWAN or region != self.EU868:
            raise Exception("Solo EU868 soportado")
        self.dev_addr = device_address
        self.nwk_skey = network_key
        self.app_skey = app_key

    def send(self, payload, fcnt, port=1):
        mhdr = bytes([0x40])  # Unconfirmed Data Up
        fctrl = bytes([0x00])
        fcnt_bytes = fcnt.to_bytes(2, 'little')
        frame = mhdr + self.dev_addr + fctrl + fcnt_bytes + bytes([port]) + payload
        mic = bytes([0x00, 0x00, 0x00, 0x00])  # MIC simplificado
        frame += mic
        self.sx127x.send(frame)
```

main.py

python

```python
from sx127x import SX127x
from lora import LoRa
from machine import Pin, SPI
import time
import ubinascii

# Configuración SPI para ESP32 con RFM95
spi = SPI(1, baudrate=10000000, polarity=0, phase=0, sck=Pin(5), mosi=Pin(27), miso=Pin(19))
cs = Pin(18, Pin.OUT)
rst = Pin(14, Pin.OUT)
dio0 = Pin(26, Pin.IN)

# Inicializar módulo LoRa
lora_module = SX127x(spi, cs, rst, dio0, freq=868.0)  # Cambia a 915.0 si es necesario

# Configuración de TTN (reemplaza con tus valores)
dev_addr = ubinascii.unhexlify('260B1234')
nwk_skey = ubinascii.unhexlify('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX')
app_skey = ubinascii.unhexlify('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX')

# Inicializar LoRaWAN
lora = LoRa(lora_module)
lora.init(mode=LoRa.LORAWAN, region=LoRa.EU868, device_address=dev_addr, network_key=nwk_skey, app_key=app_skey)

# Contador de tramas
fcnt = 0

while True:
    payload = "Prueba de cobertura TTN"
    lora.send(payload.encode(), fcnt)
    fcnt += 1
    print("Enviado:", payload)
    time.sleep(30)  # Enviar cada 30 segundos (ajusta según duty cycle)
```

Ajustes para TTGO LoRa: Si usas una TTGO LoRa V1.6, cambia en main.py:

- rst = Pin(23, Pin.OUT) (en lugar de GPIO 14).
    
- Elimina los parámetros SPI, cs, rst y dio0 de SX127x y define los pines directamente en sx127x.py como en mi respuesta anterior.
    

---

Paso 4: Cargar y ejecutar

1. Sube los archivos:
    
    - Conecta el ESP32 a tu PC.
        
    - Usa Thonny para subir sx127x.py, lora.py y main.py al ESP32.
        
2. Ejecuta:
    
    - Reinicia el ESP32 o ejecuta main.py.
        
    - Verás mensajes en la consola del IDE cada vez que se envíe un paquete.
        

---

Paso 5: Verificar cobertura en TTN

1. Revisa "Live Data" en TTN:
    - Ve a tu aplicación en TTN > "Live Data".
    - Si los mensajes llegan ( Ejemplo: payload_raw: "UHJ1ZWJhIGRlIGNvYmVydHVyYSBUVE4="), hay cobertura.
    - Usa "Payload Formats" para decodificar el payload si quieres verlo en texto.
        
2. Interpreta los resultados:
    - Datos recibidos: Hay un gateway TTN activo cerca y tienes cobertura.
    - Sin datos:
        - Verifica que la frecuencia coincida con tu región (868 MHz o 915 MHz).
        - Asegúrate de que las claves de TTN estén correctas.
        - Confirma que hay un gateway cercano (usa TTN Mapper).
        - Prueba en otra ubicación si no hay cobertura.
            

---

Paso 6: Pruebas adicionales
- Cambia de ubicación: Si no hay cobertura, mueve la placa a otra posición (cerca de una ventana o al aire libre) y repite.
- Aumenta potencia: El código ya usa máxima potencia (REG_PA_CONFIG, 0x8F), pero asegúrate de que la antena esté bien conectada.
- Reduce intervalo: Para pruebas rápidas, baja time.sleep(30) a 10 segundos, pero respeta el duty cycle de LoRaWAN (1% en Europa).

---

Conclusión

Con este setup, puedes confirmar si hay cobertura TTN en tu área. Si los mensajes llegan a la consola, tienes conexión; si no, es probable que no haya un gateway activo cerca o que necesites ajustar la configuración. ¡Avísame si necesitas ayuda con los resultados o ajustes específicos!

### Cómo saber si tenemos cobertura TTN

TTN Mapper es una herramienta de código abierto y colaborativa diseñada para mapear la cobertura real de la red LoRaWAN de The Things Network (TTN). Su objetivo es proporcionar a la comunidad una visión detallada de cómo funcionan los gateways TTN en el mundo real, mostrando dónde hay señal y qué tan fuerte es. A continuación, te detallo todo lo que necesitas saber sobre TTN Mapper:

---

¿Qué es TTN Mapper?

TTN Mapper es una iniciativa comunitaria que recolecta datos de cobertura enviados por dispositivos LoRaWAN (nodos) y los utiliza para crear un mapa interactivo. Este mapa ayuda a los usuarios a:

- Identificar zonas con cobertura TTN.
- Detectar áreas sin señal donde podría ser necesario instalar nuevos gateways
- Evaluar el rendimiento de los gateways existentes (basado en métricas como RSSI y SNR).

El mapa está disponible en ttnmapper.org y es de acceso público, lo que lo hace útil tanto para usuarios finales como para quienes planean despliegues de IoT.

---

¿Cómo funciona?

TTN Mapper depende de contribuciones de la comunidad. Los nodos LoRaWAN envían datos que son procesados y visualizados en el mapa. Hay dos formas principales de contribuir:

1. Nodos con GPS integrado:
    
    - Un dispositivo LoRaWAN con GPS transmite su ubicación (latitud, longitud, y opcionalmente altitud) junto con datos de señal (RSSI y SNR).
        
    - Estos datos se envían a TTN, y una integración en la consola de TTN los pasa a TTN Mapper.
        
    - Requiere configurar una integración "Webhook" en TTN con el formato adecuado (por ejemplo, JSON con latitude, longitude, etc.).
        
2. Aplicación móvil:
    
    - Puedes usar la app TTN Mapper (disponible para Android e iOS) junto con cualquier nodo LoRaWAN.
        
    - El nodo envía mensajes a TTN, y la app del teléfono (usando su GPS) asocia la ubicación del teléfono con los mensajes recibidos por los gateways.
        
    - Esto es ideal si tu nodo no tiene GPS.
        

Los datos recolectados se agregan en un mapa de calor que muestra:

- Puntos de medición: Lugares donde un nodo ha enviado datos con éxito.
    
- Líneas: Conexiones entre la posición del nodo y los gateways que recibieron el mensaje.
    
- Colores: Intensidad de la señal (verde para buena señal, rojo para débil).
    

---

Características principales

1. Mapa global de cobertura:
    
    - Muestra la cobertura medida de gateways TTN en todo el mundo.
        
    - Puedes filtrar por regiones o buscar nodos específicos en "Advanced Maps".
        
2. Datos en tiempo real:
    
    - A medida que los nodos envían datos, el mapa se actualiza (aunque puede haber un retraso en el procesamiento).
        
3. Modo experimental:
    
    - Si mides cobertura en condiciones inusuales (como desde un avión o globo), puedes marcar los datos como "experimental" para no afectar el mapa principal.
        
4. Soporte para diferentes formatos:
    
    - Admite payloads como Cayenne LPP o JSON personalizado, siempre que incluyan coordenadas.
        
5. Código abierto:
    
    - El proyecto está disponible en GitHub (github.com/ttnmapper), permitiendo contribuciones y adaptaciones.
        

---

Requisitos para contribuir

- Dispositivo LoRaWAN: Un nodo que transmita a TTN (puede ser un ESP32 con RFM95, una TTGO LoRa, etc.).
    
- Gateway TTN: Debe haber al menos un gateway activo cerca que reciba los mensajes.
    
- Ubicación: Datos de GPS (desde el nodo o un teléfono).
    
- Configuración en TTN:
    
    - Registrar el dispositivo en TTN (usando ABP o OTAA).
        
    - Configurar una integración TTN Mapper en la consola de TTN bajo "Integrations" > "Webhooks" > "TTN Mapper".
        
    - Opcional: Usar un decodificador de payload en TTN para interpretar los datos.
        

---

Limitaciones

- Dependencia de gateways: Si no hay gateways TTN cerca, no se registrará cobertura.
    
- Precisión del GPS: TTN Mapper descarta datos con mala precisión (HDOP > 2 o accuracy > 10 metros).
    
- Datos experimentales: Mediciones desde alturas inusuales (como drones) no se muestran en el mapa principal a menos que se consulten específicamente.
    
- Privacidad: Los gateways deben tener su ubicación pública en TTN para aparecer en el mapa.
    

---

Cómo usar TTN Mapper para probar cobertura

1. Configura tu nodo:
    
    - Usa el código de mi respuesta anterior para enviar mensajes simples a TTN.
        
    - Asegúrate de que el nodo esté registrado como ABP en TTN y usa las claves correctas.
        
2. Activa la integración:
    
    - En TTN, ve a tu aplicación > "Integrations" > "Webhooks" > "TTN Mapper".
        
    - Completa:
        
        - Webhook ID: Un nombre único ( Ejemplo: mapper-test).
            
        - Email: Tu correo para asociar los datos.
            
        - Experiment name: Déjalo vacío a menos que sea una prueba inusual.
            
3. Prueba en el campo:
    
    - Enciende tu nodo y muévelo por el área de interés.
        
    - Si no tiene GPS, usa la app TTN Mapper en tu teléfono (introduce el Device ID en "Node address").
        
4. Revisa el mapa:
    
    - Visita ttnmapper.org, ve a "Advanced Maps" y busca tu Device ID.
        
    - Si ves puntos y líneas, hay cobertura; si no, no hay gateways activos cerca.
        

---

Ejemplo práctico

Supongamos que tienes una TTGO LoRa V1.6:

- Sube el código de main.py de mi respuesta anterior (ajustado para TTGO con RST en GPIO 23).
    
- Camina por tu ciudad con la placa encendida.
    
- En TTN, verifica que los mensajes llegan en "Live Data".
    
- En ttnmapper.org, busca tu Device ID. Si aparecen puntos conectados a gateways, tienes cobertura TTN.
    

---

Beneficios para la comunidad

- Ayuda a otros a decidir dónde instalar nodos o gateways.
    
- Mejora la planificación de redes IoT al mostrar "blancos" en la cobertura.
    
- Fomenta la colaboración al compartir datos abiertos bajo licencia PDDL v1.0.
    

---

Recursos adicionales

- Documentación oficial: docs.ttnmapper.org.
    
- Mapa: ttnmapper.org.
    
- Soporte: Canal #ttn-mapper en Slack de TTN.
    

TTN Mapper es una herramienta poderosa para entender y expandir la red TTN. Si necesitas más detalles o ayuda con un caso específico, ¡dímelo!




### The Thing Network

The Things Network (TTN), ahora conocido como The Things Stack Community Edition en su versión gratuita, es una plataforma global de código abierto diseñada para facilitar la construcción y gestión de redes de Internet de las Cosas (IoT) utilizando la tecnología LoRaWAN. TTN tiene como objetivo democratizar el acceso a redes de baja potencia y largo alcance, permitiendo a individuos, empresas y comunidades conectar dispositivos IoT sin depender de infraestructuras costosas o propietarios privados como las redes celulares tradicionales.

A continuación, te doy una explicación detallada de qué es TTN, cómo funciona, sus componentes, características y beneficios:

---

¿Qué es TTN?

TTN es una red colaborativa y descentralizada basada en la tecnología LoRaWAN (Long Range Wide Area Network), un protocolo de comunicación inalámbrica diseñado para dispositivos IoT que necesitan enviar pequeñas cantidades de datos a largas distancias con un consumo mínimo de energía. Fue fundada en 2015 por Wienke Giezeman y Johan Stokking en Ámsterdam, Países Bajos, con la visión de crear una red global abierta para IoT, impulsada por la comunidad.

TTN opera bajo dos pilares principales:

1. Infraestructura física: Una red de gateways (puntos de acceso) instalados y mantenidos por voluntarios y organizaciones en todo el mundo.
    
2. Plataforma de software: Un backend (The Things Stack) que gestiona la comunicación entre dispositivos, gateways y aplicaciones, todo accesible a través de una consola web gratuita.
    

Hoy en día, TTN es parte de The Things Industries (TTI), que ofrece versiones comerciales del software, pero la versión comunitaria sigue siendo gratuita y de código abierto.

---

¿Cómo funciona TTN?

TTN utiliza el protocolo LoRaWAN, que separa la red en tres elementos clave: dispositivos (nodos), gateways y servidores de red. Aquí te explico cada uno y cómo interactúan:

1. Dispositivos (nodos):
    
    - Son los sensores o actuadores IoT (como una ESP32 con módulo LoRa RFM95).
        
    - Envían pequeños paquetes de datos (payloads) usando LoRa, una modulación de radio de baja potencia y largo alcance.
        
    - Ejemplo: Un sensor de temperatura que envía datos cada 10 minutos.
        
2. Gateways:
    
    - Son puntos de acceso que reciben las señales LoRa de los nodos y las envían a los servidores de TTN a través de Internet (usualmente WiFi o Ethernet).
        
    - No descifran los datos, solo actúan como puente.
        
    - Ejemplo: Un gateway casero con una Raspberry Pi y un módulo LoRa o un dispositivo comercial como Dragino o Kerlink.
        
    - Cualquier nodo dentro del alcance de un gateway (hasta 10-15 km en condiciones ideales) puede conectarse si usa TTN.
        
3. Servidores de red (The Things Stack):
    
    - Procesan los datos recibidos por los gateways.
        
    - Gestionan la autenticación, encriptación y enrutamiento de los mensajes a las aplicaciones correspondientes.
        
    - Proveen una consola web (console.thethingsnetwork.org) para registrar dispositivos, gateways y aplicaciones.
        

Flujo básico:

- Un nodo envía un mensaje LoRa (por ejemplo, "Temperatura: 25°C").
    
- Uno o más gateways cercanos captan la señal y la envían a los servidores TTN.
    
- TTN autentica el mensaje, lo desencripta y lo entrega a la aplicación registrada por el usuario.
    
- El usuario puede ver los datos en la consola o integrarlos con servicios externos (como bases de datos o dashboards).
    

---

Componentes clave de TTN

1. LoRaWAN:
    
    - Protocolo de red que define cómo los dispositivos se comunican con los gateways y servidores.
        
    - Usa bandas ISM libres (868 MHz en Europa, 915 MHz en América) para evitar costos de licencias.
        
    - Admite dos modos de activación:
        
        - OTAA (Over-the-Air Activation): Más seguro, el dispositivo negocia claves dinámicas con el servidor.
            
        - ABP (Activation By Personalization): Claves preconfiguradas, más simple para pruebas.
            
2. Gateways comunitarios:
    
    - Cualquiera puede instalar un gateway y conectarlo a TTN, ampliando la red.
        
    - Los gateways registrados como públicos comparten su cobertura con toda la comunidad.
        
3. The Things Stack:
    
    - Software de código abierto que gestiona la red (disponible en GitHub).
        
    - Incluye:
        
        - Network Server: Maneja las comunicaciones LoRaWAN.
            
        - Application Server: Enruta datos a aplicaciones de usuario.
            
        - Join Server: Gestiona la autenticación OTAA.
            
4. Consola TTN:
    
    - Interfaz web para:
        
        - Registrar dispositivos y gateways.
            
        - Configurar aplicaciones.
            
        - Ver datos en tiempo real ("Live Data").
            
        - Crear integraciones (HTTP, MQTT, etc.).
            

---

Características principales

- Gratuito: La versión comunitaria no tiene costos de suscripción ni límites estrictos de uso (aunque respeta el "fair use policy").
    
- Global y descentralizado: Cientos de miles de gateways en más de 150 países, mantenidos por la comunidad.
    
- Baja potencia: Ideal para dispositivos alimentados por batería (puede durar años con una sola carga).
    
- Largo alcance: Hasta 15 km en zonas rurales, 1-2 km en ciudades.
    
- Seguridad: Encriptación AES-128 de extremo a extremo (nodo a aplicación).
    
- Escalable: Soporta miles de dispositivos por aplicación.
    

---

Limitaciones

- Cobertura dependiente de la comunidad: Si no hay gateways cerca, no hay servicio a menos que instales uno.
    
- Duty cycle: En regiones como Europa, las restricciones legales limitan el tiempo de transmisión (1% por canal), lo que afecta la frecuencia de envío.
    
- Fair use policy: Máximo de 10 mensajes downlink por dispositivo al día y límites de tiempo aire en la red gratuita.
    
- No garantías: Al ser comunitaria, no hay soporte oficial ni SLA (Service Level Agreement).
    

---

Beneficios

1. Acceso abierto: Cualquier persona puede usarlo sin costo inicial, ideal para makers, estudiantes y startups.
    
2. Ecosistema colaborativo: La comunidad comparte recursos como TTN Mapper para mapear cobertura.
    
3. Flexibilidad: Compatible con hardware barato (ESP32, RFM95) y software personalizable.
    
4. Integraciones: Fácil conexión con plataformas como Node-RED, AWS, o bases de datos vía MQTT o HTTP.
    

---

Ejemplo práctico

Imagina que quieres monitorear la temperatura en un campo:

- Configuras una ESP32 con un módulo LoRa RFM95 y un sensor DHT11.
    
- Registras el dispositivo en TTN con ABP, usando claves únicas.
    
- Un gateway TTN a 5 km recibe los datos y los envía al servidor.
    
- En la consola TTN, ves "Temperatura: 25°C" cada 10 minutos.
    
- Configuras una integración para guardar los datos en Google Sheets.
    

Si no hay un gateway cerca, puedes instalar uno propio (por ejemplo, con una Raspberry Pi) y conectarlo a TTN.

---

Cómo empezar con TTN

1. Crea una cuenta: Regístrate en console.thethingsnetwork.org.
    
2. Registra una aplicación: Define un ID y región ( Ejemplo: eu1 para Europa).
    
3. Añade un dispositivo: Usa ABP o OTAA y obtén las claves (DevAddr, NwkSKey, AppSKey).
    
4. Configura tu nodo: Usa MicroPython o Arduino con las claves de TTN (como en mis ejemplos anteriores).
    
5. Verifica cobertura: Envía datos y revisa "Live Data" en la consola.
    
6. Opcional - Instala un gateway: Si no hay cobertura, compra o construye un gateway y regístralo en TTN.
    

---

Comparación con alternativas

- Redes celulares (NB-IoT, LTE-M): Más rápidas pero costosas y consumen más energía.
    
- Sigfox: Propietario, con tarifas y menos flexibilidad.
    
- Helium: Similar a TTN pero basada en blockchain, con incentivos económicos para gateways.
    

TTN destaca por ser gratuito, abierto y comunitario, aunque depende de la infraestructura voluntaria.

---

Conclusión

The Things Network es una solución poderosa y accesible para IoT de bajo costo y largo alcance. Su enfoque colaborativo lo hace único, pero su eficacia depende de la densidad de gateways en tu área. Es ideal para proyectos de prueba, educación o despliegues comunitarios, y con herramientas como TTN Mapper, puedes incluso contribuir a su mejora. Si tienes dudas específicas o quieres profundizar en algo (como configuraciones o hardware), ¡avísame!

### Lora Alliance

La LoRa Alliance es una organización internacional sin fines de lucro fundada en 2015 con el objetivo de promover, estandarizar y acelerar la adopción del protocolo LoRaWAN como una solución líder para redes de área amplia de bajo consumo (LPWAN) en el Internet de las Cosas (IoT). Reúne a empresas, desarrolladores y organizaciones de todo el mundo para garantizar la interoperabilidad, seguridad y escalabilidad de las soluciones basadas en LoRaWAN.

A continuación, te doy una explicación detallada sobre qué es la LoRa Alliance, su propósito, estructura, logros, cómo funciona y su impacto en el ecosistema IoT.

---

¿Qué es la LoRa Alliance?

La LoRa Alliance es el organismo detrás del estándar abierto LoRaWAN, que utiliza la tecnología de modulación LoRa (desarrollada por Semtech) como base para conectar dispositivos IoT de baja potencia a largas distancias. Su misión es estandarizar este protocolo para que hardware y software de diferentes fabricantes sean compatibles, fomentando un ecosistema global de soluciones IoT interoperables.

- Fundación: Creada en marzo de 2015 en el Mobile World Congress en Barcelona.
    
- Sede: Aunque opera globalmente, su administración principal está en Estados Unidos.
    
- Lema: "Connecting the world, one device at a time" (Conectando el mundo, un dispositivo a la vez).
    

---

Propósito y objetivos

La LoRa Alliance tiene varios objetivos clave:

1. Estandarización:
    
    - Desarrollar y mantener la especificación LoRaWAN como un estándar abierto.
        
    - Asegurar que los dispositivos y redes sean interoperables entre fabricantes.
        
2. Promoción:
    
    - Fomentar la adopción de LoRaWAN en sectores como ciudades inteligentes, agricultura, industria, salud y más.
        
    - Educar a empresas y comunidades sobre los beneficios de esta tecnología.
        
3. Certificación:
    
    - Ofrecer un programa de certificación para garantizar que los dispositivos LoRaWAN cumplan con las especificaciones técnicas y de seguridad.
        
4. Innovación:
    
    - Apoyar el desarrollo de nuevas funcionalidades y mejoras en el protocolo (por ejemplo, geolocalización, roaming).
        
5. Ecosistema colaborativo:
    
    - Crear una red de socios (fabricantes, operadores, integradores) para expandir la disponibilidad de soluciones LoRaWAN.
        

---

Estructura organizativa

La LoRa Alliance está formada por más de 500 miembros (a 2025), que incluyen empresas tecnológicas, operadores de red, fabricantes de hardware y universidades. Su estructura incluye:

1. Miembros principales (Sponsor Members):
    
    - Empresas líderes que financian y dirigen la alianza, como Semtech (creador de LoRa), Cisco, IBM, Orange, Comcast y STMicroelectronics.
        
    - Tienen voto en la junta directiva y definen la estrategia.
        
2. Miembros contribuyentes (Contributor Members):
    
    - Participan en comités técnicos y aportan al desarrollo del estándar.
        
    - Ejemplo: Fabricantes de gateways como Kerlink o Multitech.
        
3. Miembros asociados (Adopter Members):
    
    - Usan el estándar LoRaWAN para desarrollar productos o servicios.
        
    - Ejemplo: Startups que fabrican sensores.
        
4. Comités técnicos:
    
    - Technical Committee: Define y actualiza la especificación LoRaWAN.
        
    - Certification Committee: Gestiona el programa de certificación.
        
    - Otros grupos enfocados en marketing, seguridad y regionalización.
        
5. Junta directiva:
    
    - Compuesta por representantes de los miembros principales, toma decisiones estratégicas.
        

---

Logros y contribuciones

Desde su creación, la LoRa Alliance ha tenido un impacto significativo en el IoT:

1. Especificación LoRaWAN:
    
    - Versión inicial (1.0) lanzada en 2015.
        
    - Actualizaciones como 1.0.4, 1.1 (con roaming y seguridad mejorada) y 1.0.2 RP (Regional Parameters) para adaptar las bandas ISM por región.
        
    - Documentación pública disponible en lora-alliance.org.
        
2. Programa de certificación:
    
    - Más de 500 productos certificados (nodos, gateways, módulos), asegurando interoperabilidad.
        
    - Laboratorios autorizados en todo el mundo (por ejemplo, TÜV Rheinland) prueban dispositivos.
        
3. Crecimiento global:
    
    - Presencia en más de 100 países con redes públicas (como TTN) y privadas.
        
    - Soporte para bandas ISM en Europa (868 MHz), América (915 MHz), Asia (433 MHz), etc.
        
4. Funcionalidades avanzadas:
    
    - Geolocalización: Uso de TDoA (Time Difference of Arrival) para ubicar dispositivos sin GPS.
        
    - Roaming: Permite que dispositivos se conecten a redes distintas al viajar.
        
    - FUOTA (Firmware Update Over The Air): Actualización remota de firmware en nodos.
        
5. Ecosistema diverso:
    
    - Desde sensores baratos (como RFM95) hasta soluciones industriales complejas.
        

---

Cómo funciona la LoRa Alliance

1. Desarrollo del estándar:
    
    - Los comités técnicos redactan las especificaciones LoRaWAN (disponibles gratuitamente).
        
    - Se publican actualizaciones periódicas tras consenso entre miembros.
        
2. Certificación:
    
    - Los fabricantes envían sus dispositivos a laboratorios acreditados.
        
    - Se prueban aspectos como conformidad con el protocolo, seguridad y rendimiento.
        
    - Los dispositivos certificados reciben un sello "LoRaWAN Certified".
        
3. Colaboración:
    
    - Eventos como LoRaWAN Live reúnen a miembros para demostraciones y networking.
        
    - Recursos educativos (webinars, whitepapers) promueven el conocimiento.
        
4. Soporte regional:
    
    - Define parámetros específicos por región (frecuencias, duty cycle) para cumplir con regulaciones locales.
        

---

Impacto en el ecosistema IoT

- Interoperabilidad: Un sensor certificado de un fabricante (por ejemplo, Seeed) funciona con un gateway de otro (como Dragino) y una red como TTN.
    
- Adopción masiva: Empresas como Amazon (AWS IoT Core for LoRaWAN) y Google han integrado LoRaWAN gracias a su estandarización.
    
- Competencia: Compite con tecnologías como NB-IoT y Sigfox, destacando por ser abierto y flexible.
    

---

Relación con TTN y otros

- The Things Network (TTN): Usa LoRaWAN como protocolo y sigue las especificaciones de la LoRa Alliance. Muchos dispositivos certificados por la alianza son compatibles con TTN.
    
- Semtech: Como creador de LoRa, es un miembro fundador y provee los chips (SX127x, SX126x) que cumplen el estándar.
    
- Otras redes: Helium, LORIOT y ChirpStack también se basan en LoRaWAN y se benefician del trabajo de la alianza.
    

---

Ventajas de la LoRa Alliance

- Estandarización abierta: Evita la fragmentación del mercado IoT.
    
- Confianza: La certificación asegura calidad y compatibilidad.
    
- Innovación colectiva: Las mejoras vienen de cientos de empresas, no de una sola entidad.
    
- Acceso global: Adaptado a regulaciones y necesidades de cada región.
    

---

Limitaciones

- Dependencia de Semtech: LoRa es una tecnología patentada, lo que limita la capa física a sus chips.
    
- Velocidad de adopción: Algunas regiones tardan en implementar redes debido a la falta de infraestructura.
    
- Competencia: Tecnologías como NB-IoT (respaldada por operadores celulares) tienen mayor apoyo institucional.
    

---

Ejemplo práctico

Imagina que fabricas un sensor de temperatura con un módulo RFM95:

- Lo diseñas según la especificación LoRaWAN 1.0.4.
    
- Lo certificas con la LoRa Alliance para garantizar que funcione con cualquier gateway.
    
- Lo conectas a TTN, Helium o una red privada, y los usuarios lo integran sin problemas gracias al estándar.
    

---

Recursos

- Sitio web: lora-alliance.org
    
- Especificaciones: Descargables gratuitamente ( Ejemplo: LoRaWAN 1.1 Specification).
    
- Eventos: LoRaWAN Live y conferencias regionales.
    

---

Conclusión

La LoRa Alliance es el corazón del ecosistema LoRaWAN, asegurando que esta tecnología sea un estándar global confiable y accesible. Su trabajo permite que redes como TTN prosperen y que fabricantes creen soluciones interoperables, impulsando el IoT de bajo consumo. Si quieres más detalles sobre certificación o su relación con hardware específico, ¡avísame!

## Alternativas a TTN

Si buscas alternativas a The Things Network (TTN) para implementar soluciones IoT basadas en LoRaWAN u otras tecnologías de bajo consumo y largo alcance, hay varias opciones disponibles. Cada una tiene sus propias características, ventajas y limitaciones, dependiendo de tus necesidades específicas (cobertura, costo, privacidad, escalabilidad, etc.). A continuación, te detallo las principales alternativas a TTN, agrupadas por tipo de tecnología y enfoque:

---

Alternativas basadas en LoRaWAN

LoRaWAN es el protocolo en el que se basa TTN, por lo que estas alternativas también usan LoRaWAN pero con diferentes enfoques de gestión y despliegue.

1. The Things Industries (TTI)
    
    - Descripción: Es la versión comercial de TTN, ofrecida por la misma empresa detrás de The Things Network. Usa The Things Stack, pero con soporte empresarial y opciones privadas.
        
    - Ventajas:
        
        - Infraestructura gestionada con SLA (Service Level Agreement).
            
        - Soporte técnico profesional.
            
        - Opciones de nube privada o despliegue local (on-premise).
            
        - Integración con gateways TTN existentes.
            
    - Desventajas:
        
        - Costo asociado (planes desde ~€99/mes para pequeñas empresas).
            
        - Menos enfoque comunitario que TTN.
            
    - Ideal para: Empresas que necesitan fiabilidad y soporte, pero quieren seguir usando LoRaWAN.
        
2. Helium
    
    - Descripción: Una red LoRaWAN descentralizada basada en blockchain. Los usuarios instalan "Hotspots" (gateways) y ganan criptomonedas (HNT) por proporcionar cobertura.
        
    - Ventajas:
        
        - Cobertura global en crecimiento gracias a incentivos económicos.
            
        - Red peer-to-peer sin dependencia de una entidad central.
            
        - Costo por mensaje bajo (~$0.0001 por paquete).
            
    - Desventajas:
        
        - Requiere aprender sobre blockchain y gestionar HNT.
            
        - Cobertura aún limitada en algunas áreas.
            
        - Dependencia de Hotspots de terceros.
            
    - Ideal para: Proyectos que buscan una alternativa descentralizada con incentivos para expandir la red.
        
3. LORIOT
    
    - Descripción: Plataforma LoRaWAN comercial que ofrece servidores de red gestionados en la nube o locales, con soporte para gateways públicos y privados.
        
    - Ventajas:
        
        - Alta escalabilidad y seguridad (certificaciones ISO).
            
        - Despliegue híbrido (público, privado o local).
            
        - Soporte técnico y documentación extensa.
            
    - Desventajas:
        
        - Costo mensual (desde ~€50 dependiendo del plan).
            
        - Menos comunidad abierta que TTN.
            
    - Ideal para: Empresas con necesidades de privacidad o despliegues a gran escala.
        
4. ChirpStack
    
    - Descripción: Una pila de software LoRaWAN de código abierto que puedes instalar en tu propio servidor o nube (no depende de una red comunitaria como TTN).
        
    - Ventajas:
        
        - Gratuito y personalizable (código en GitHub).
            
        - Control total sobre la red (privacidad y soberanía de datos).
            
        - Compatible con cualquier gateway LoRaWAN.
            
    - Desventajas:
        
        - Requiere conocimientos técnicos para instalar y mantener.
            
        - No incluye una red pública preexistente; debes desplegar tus propios gateways.
            
    - Ideal para: Usuarios técnicos o empresas que quieren una red LoRaWAN privada.
        
5. Actility ThingPark
    
    - Descripción: Plataforma LoRaWAN empresarial con soluciones gestionadas para operadores y grandes despliegues.
        
    - Ventajas:
        
        - Infraestructura robusta para redes masivas.
            
        - Soporte para roaming entre redes LoRaWAN.
            
        - Integraciones avanzadas con sistemas corporativos.
            
    - Desventajas:
        
        - Costo elevado, orientado a grandes organizaciones.
            
        - Menos accesible para proyectos pequeños o individuales.
            
    - Ideal para: Operadores de telecomunicaciones o proyectos industriales.
        

---

Alternativas basadas en otras tecnologías

Si no estás restringido a LoRaWAN, hay otras tecnologías de redes de área amplia de baja potencia (LPWAN) que pueden reemplazar TTN:

1. Sigfox
    
    - Descripción: Red LPWAN propietario que opera en bandas ISM (868 MHz o 915 MHz), gestionada por Sigfox y sus socios operadores.
        
    - Ventajas:
        
        - Cobertura amplia en muchos países (operadores locales).
            
        - Simplicidad: no necesitas gateways propios.
            
        - Bajo consumo energético.
            
    - Desventajas:
        
        - Costo por dispositivo y suscripción (~€1-10/año por dispositivo).
            
        - Límite estricto de mensajes (140 uplink/día, 4 downlink/día).
            
        - Red cerrada, no personalizable.
            
    - Ideal para: Proyectos comerciales con cobertura garantizada y pocos mensajes diarios.
        
2. NB-IoT (Narrowband IoT)
    
    - Descripción: Tecnología LPWAN basada en redes celulares 4G/5G, ofrecida por operadores móviles como Vodafone o AT&T.
        
    - Ventajas:
        
        - Excelente cobertura en áreas urbanas (usa torres celulares).
            
        - Mayor ancho de banda que LoRaWAN (hasta 250 kbps).
            
        - Soporte nativo para roaming.
            
    - Desventajas:
        
        - Costo de suscripción mensual por SIM.
            
        - Consumo energético más alto que LoRaWAN.
            
        - Dependencia de operadores móviles.
            
    - Ideal para: Aplicaciones que necesitan mayor velocidad y ya tienen infraestructura celular.
        
3. LTE-M (LTE Machine Type Communication)
    
    - Descripción: Otra tecnología celular LPWAN, más rápida que NB-IoT, también basada en redes 4G/5G.
        
    - Ventajas:
        
        - Alta velocidad (hasta 1 Mbps).
            
        - Soporte para voz y datos más grandes.
            
        - Cobertura celular estable.
            
    - Desventajas:
        
        - Costos más altos (suscripción y hardware).
            
        - Mayor consumo de batería.
            
    - Ideal para: IoT móvil o aplicaciones con requisitos de datos más exigentes.
        
4. Weightless
    
    - Descripción: Familia de estándares LPWAN abiertos que operan en bandas ISM o licenciadas (Weightless-N, -P, -W).
        
    - Ventajas:
        
        - Flexibilidad en configuraciones.
            
        - Weightless-P compite con LoRaWAN en alcance y eficiencia.
            
    - Desventajas:
        
        - Adopción limitada, poca infraestructura disponible.
            
        - Requiere despliegue propio de red.
            
    - Ideal para: Proyectos experimentales o redes privadas.
        

---

Comparación rápida

|Plataforma|Tecnología|Costo|Cobertura|Control|Ideal para|
|---|---|---|---|---|---|
|TTN|LoRaWAN|Gratis|Comunitaria|Limitado|Makers, comunidades|
|TTI|LoRaWAN|Pago|Gestionada|Completo|Empresas pequeñas/medias|
|Helium|LoRaWAN|Bajo (HNT)|Comunitaria|Descentralizado|Innovadores, criptoentusiastas|
|LORIOT|LoRaWAN|Pago|Mixta|Completo|Empresas, privacidad|
|ChirpStack|LoRaWAN|Gratis|Propia|Total|Técnicos, redes privadas|
|Sigfox|Sigfox|Pago|Operadores|Ninguno|Despliegues comerciales|
|NB-IoT|Celular|Pago|Celular|Ninguno|Ciudades, alta densidad|
|LTE-M|Celular|Pago|Celular|Ninguno|IoT móvil, datos grandes|

---

Recomendaciones según tu caso

- Si quieres algo gratuito y comunitario como TTN: Prueba Helium (si hay cobertura) o ChirpStack (si puedes instalar tu propia red).
    
- Si necesitas cobertura garantizada: Sigfox, NB-IoT o LTE-M, aunque con costo.
    
- Si buscas control total: ChirpStack para LoRaWAN privado o despliegues locales con LORIOT.
    
- Si priorizas escalabilidad y soporte: TTI o Actility.
    

---

Conclusión

TTN es único por su enfoque gratuito y comunitario, pero alternativas como Helium ofrecen incentivos económicos, mientras que soluciones comerciales como TTI o LORIOT brindan mayor fiabilidad. Si tu proyecto requiere algo más rápido o con cobertura celular, NB-IoT o LTE-M son opciones viables. ¿Tienes un caso específico en mente? Puedo ayudarte a elegir la mejor alternativa o configurar algo concreto. ¡Dímelo!


## Ejemplo LoraWAN

A continuación, te proporciono un tutorial detallado y paso a paso sobre cómo utilizar The Things Network (TTN) con LoRaWAN desde MicroPython en una placa ESP32 equipada con un módulo LoRa RFM95. Este tutorial incluye ejemplos prácticos y explicaciones claras para que puedas implementarlo incluso si eres principiante. Vamos a configurar un nodo LoRaWAN que envíe datos a TTN utilizando el método de activación ABP (Activation By Personalization), ya que es más sencillo para empezar.

---

Tutorial: Conectar ESP32 con RFM95 a TTN usando MicroPython

Requisitos previos

1. Hardware:
    
    - Placa ESP32 (como la Wemos TTGO LoRa32 o cualquier ESP32 genérico).
        
    - Módulo LoRa RFM95 (compatible con SX1276).
        
    - Antena adecuada para la frecuencia de tu región (868 MHz para Europa, 915 MHz para América del Norte, etc.).
        
    - Cables para conexiones si usas un módulo RFM95 separado.
        
    - Computadora con puerto USB.
        
2. Software:
    
    - MicroPython instalado en tu ESP32 (puedes descargarlo desde micropython.org y flashearlo con herramientas como esptool.py).
        
    - Un IDE como Thonny o uPyCraft para cargar código al ESP32.
        
    - Cuenta en The Things Network (TTN) creada en console.thethingsnetwork.org.
        
3. Conocimientos básicos:
    
    - Familiaridad con MicroPython y conexiones SPI.
        
    - Acceso a un gateway LoRaWAN cercano registrado en TTN o tu propio gateway.
        

---

Paso 1: Conectar el RFM95 al ESP32

El módulo RFM95 utiliza SPI para comunicarse con el ESP32. Asegúrate de conectar los pines correctamente. Aquí tienes una configuración típica:

|Pin RFM95|Pin ESP32 (ejemplo)|Descripción|
|---|---|---|
|VCC|3.3V|Alimentación|
|GND|GND|Tierra|
|MOSI|GPIO 27|SPI MOSI|
|MISO|GPIO 19|SPI MISO|
|SCK|GPIO 5|SPI Clock|
|NSS (CS)|GPIO 18|Chip Select|
|DIO0|GPIO 26|Interrupción|
|RST|GPIO 14|Reset|

Nota: Antes de encender el ESP32, conecta la antena al RFM95 para evitar daños al módulo.

---

Paso 2: Configurar TTN

1. Inicia sesión en TTN:
    
    - Ve a console.thethingsnetwork.org y accede con tu cuenta.
        
2. Crea una aplicación:
    
    - Haz clic en "Applications" y luego en "Add Application".
        
    - Rellena los campos:
        
        - Application ID: Un nombre único ( Ejemplo: mi-app-lora).
            
        - Description: Opcional ( Ejemplo: "Aplicación de prueba con ESP32").
            
        - Handler: Selecciona tu región ( Ejemplo: eu1 para Europa).
            
    - Haz clic en "Add Application".
        
3. Registra un dispositivo:
    
    - En la pestaña de tu aplicación, ve a "Devices" y haz clic en "Register Device".
        
    - Rellena:
        
        - Device ID: Un nombre único ( Ejemplo: esp32-lora-01).
            
        - Device EUI: Genera uno automáticamente haciendo clic en el ícono de mezcla o usa uno personalizado.
            
    - Haz clic en "Register".
        
4. Configura ABP:
    
    - En la pestaña del dispositivo, ve a "Settings".
        
    - Cambia "Activation Method" a ABP.
        
    - Desactiva "Frame Counter Checks" (opcional, pero recomendado para pruebas).
        
    - Copia los siguientes valores generados:
        
        - Device Address (DevAddr).
            
        - Network Session Key (NwkSKey).
            
        - App Session Key (AppSKey).
            
    - Guárdalos, los usarás en el código.
        

---

Paso 3: Instalar las librerías en MicroPython

Necesitamos una implementación de LoRaWAN para MicroPython. Usaremos una versión simplificada basada en proyectos como uLoRaWAN o el driver de SX127x. Aquí te doy un ejemplo funcional:

1. Descarga el driver SX127x:
    
    - Puedes encontrar una implementación en GitHub (como la de LeMaRiva o aizukanne). Por simplicidad, asumimos que tienes un archivo sx127x.py y lora.py.
        
    - Sube estos archivos al ESP32 usando Thonny (arrastrándolos a la raíz del sistema de archivos).
        
2. Estructura de archivos en el ESP32:
    
    - sx127x.py: Driver del módulo RFM95.
        
    - lora.py: Clase para manejar LoRaWAN.
        
    - main.py: Tu script principal.
        

---

Paso 4: Código de ejemplo

A continuación, te doy un ejemplo funcional para enviar un mensaje simple a TTN usando ABP desde MicroPython.

python

```python
from sx127x import SX127x
from lora import LoRa
from machine import Pin, SPI
import time
import ubinascii

# Configuración de pines SPI
spi = SPI(1, baudrate=10000000, polarity=0, phase=0, sck=Pin(5), mosi=Pin(27), miso=Pin(19))
cs = Pin(18, Pin.OUT)  # NSS
rst = Pin(14, Pin.OUT)  # Reset
irq = Pin(26, Pin.IN)   # DIO0

# Inicializar el módulo RFM95
lora = SX127x(spi, cs, rst, irq, freq=868.0)  # Frecuencia para Europa, cambia a 915.0 si es necesario

# Configuración LoRaWAN
dev_addr = ubinascii.unhexlify('260B1234')  # Reemplaza con tu Device Address de TTN
nwk_skey = ubinascii.unhexlify('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX')  # Reemplaza con tu Network Session Key
app_skey = ubinascii.unhexlify('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX')  # Reemplaza con tu App Session Key

# Inicializar LoRaWAN en modo ABP
lora.init(mode=LoRa.LORAWAN, region=LoRa.EU868, device_address=dev_addr, network_key=nwk_skey, app_key=app_skey)

# Contador de tramas (Frame Counter)
fcnt = 0

# Función para enviar datos
def send_data(payload):
    global fcnt
    lora.send(payload, fcnt, port=1)  # Puerto 1 por defecto
    fcnt += 1
    print("Datos enviados:", payload)

# Bucle principal
while True:
    payload = "Hola TTN desde ESP32!"
    send_data(payload.encode())
    time.sleep(60)  # Espera 60 segundos entre envíos
```

Notas sobre el código:

- Reemplaza dev_addr, nwk_skey y app_skey con los valores obtenidos de TTN.
    
- Ajusta la frecuencia (freq=868.0) según tu región.
    
- El módulo sx127x.py y lora.py deben estar adaptados para soportar ABP y tu región específica. Si no los tienes, busca implementaciones como las de LeMaRiva o adapta una desde Arduino LMIC.
    

---

Paso 5: Cargar y ejecutar el código

1. Conecta tu ESP32 a la computadora vía USB.
    
2. Abre Thonny y sube los archivos sx127x.py, lora.py y main.py al ESP32.
    
3. Ejecuta main.py desde Thonny o reinicia el ESP32 para que se ejecute automáticamente.
    

Si todo está configurado correctamente, verás mensajes en la consola indicando que los datos se están enviando.

---

Paso 6: Verificar en TTN

1. Ve a la pestaña "Live Data" de tu dispositivo en TTN.
    
2. Si el envío funciona, verás los payloads recibidos. Por ejemplo:
    
    ```text
    {
      "port": 1,
      "payload_raw": "SG9sYSBUVE4gZGVzZGUgRVNQMzIh"
    }
    ```
    
    - Usa la pestaña "Payload Formats" en TTN para decodificar el payload de base64 a texto si es necesario.
        

---

Paso 7: Depuración y mejoras

- Problemas comunes:
    
    - Si no ves datos en TTN, verifica:
        
        - La frecuencia coincide con tu gateway y región.
            
        - El gateway está activo y conectado a TTN.
            
        - Los pines SPI están correctamente conectados.
            
    - Aumenta el intervalo entre envíos (time.sleep) para cumplir con las restricciones de duty cycle de LoRaWAN.
        
- Mejoras:
    
    - Agrega sensores (como temperatura con un DHT11) y envía datos reales.
        
    - Implementa OTAA (Over-the-Air Activation) para una configuración más segura (requiere más código y soporte en la librería).
        

---

Ejemplo con sensor

Aquí tienes un ejemplo extendido que envía la temperatura usando un sensor DHT11:

python

```python
from sx127x import SX127x
from lora import LoRa
from machine import Pin, SPI
import time
import ubinascii
import dht

# Configuración de pines SPI
spi = SPI(1, baudrate=10000000, polarity=0, phase=0, sck=Pin(5), mosi=Pin(27), miso=Pin(19))
cs = Pin(18, Pin.OUT)
rst = Pin(14, Pin.OUT)
irq = Pin(26, Pin.IN)

# Sensor DHT11
sensor = dht.DHT11(Pin(4))

# Inicializar RFM95
lora = SX127x(spi, cs, rst, irq, freq=868.0)

# Configuración LoRaWAN
dev_addr = ubinascii.unhexlify('260B1234')
nwk_skey = ubinascii.unhexlify('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX')
app_skey = ubinascii.unhexlify('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX')

lora.init(mode=LoRa.LORAWAN, region=LoRa.EU868, device_address=dev_addr, network_key=nwk_skey, app_key=app_skey)

fcnt = 0

def send_data(payload):
    global fcnt
    lora.send(payload, fcnt, port=1)
    fcnt += 1
    print("Datos enviados:", payload)

while True:
    sensor.measure()
    temp = sensor.temperature()
    hum = sensor.humidity()
    payload = "Temp: {}C, Hum: {}%".format(temp, hum)
    send_data(payload.encode())
    time.sleep(60)
```

---

Conclusión

Con este tutorial, has configurado un ESP32 con RFM95 para enviar datos a TTN usando MicroPython. Este es un punto de partida que puedes expandir con más sensores, optimizaciones de energía (como deep sleep) o soporte para OTAA. Si tienes problemas, asegúrate de verificar las conexiones, la cobertura del gateway y la compatibilidad de las librerías. ¡Disfruta explorando LoRaWAN!